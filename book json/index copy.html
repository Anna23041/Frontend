<!DOCTYPE html>
<html class="h-full" lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Simple Form Example</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="h-full bg-gray-100">
    <div class="bg-gray-100 h-full w-full flex flex-row">
      <div class="bg-gray-100 w-[75%] h-full">
        <h1 class="text-xl text-blue-800 font-bold p-3 ml-[100px]">
          üìñAll books
        </h1>
        <div class="flex flex-row justify-center">
          <div
            id="listBooks"
            class="bg-gray-100 flex flex-row w-[80%] flex-wrap justify-between"
          >
            <div
              id="cardBook"
              class="bg-white rounded-md w-[200px] h-[280px] m-5 mt-15 p-5 hidden"
            >
              <img
                id="imageBook"
                class="max-h-[150px] max-w-[150px]"
                src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQh4e5JMJcOAZB3z-SN8PgREYAXw_WBIDLs7ffV3GOWESaUfgSAk-VQPMoL1GKBYTtMfB0&usqp=CAU"
                alt=""
              />
              <h1 id="nameBook" class="text-left font-medium text-blue-800">
                Name book
              </h1>
              <p id="discriptionBook" class="text-left text-sm p-1">About</p>
              <button
                id="favButton"
                class="bg-blue-800 text-white rounded-md p-2 w-full"
              >
                ‚ù§Ô∏èFavorite
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="bg-gray-100 w-[25%] h-full mt-5">
        <div id="favBooks" class="bg-white rounded-md w-[80%] pb-5 pl-5 pt-2">
          <h1 class="text-center mt-4 text-xl text-blue-800 font-bold">
            ‚ù§Ô∏èFavorites
          </h1>
          <ul id="listFavBooks"></ul>
        </div>
      </div>
    </div>
    <script>
      const bookCard = document.getElementById("cardBook");
      fetch("http://localhost:3000/api/books")
        .then((r) => r.json())
        .then((list) => {
          console.log(list);
          list.forEach((element) => {
            const newCard = bookCard.cloneNode(true);
            newCard.classList.remove("hidden");
            const bookTitle = newCard.querySelector("#nameBook");
            bookTitle.textContent = element.title;
            const listBook = document.getElementById("listBooks");
            const imageBook = newCard.querySelector("#imageBook");
            const paragraphBook = newCard.querySelector("#discriptionBook");
            const favButton = newCard.querySelector("#favButton");
            favButton.id = element.id;
            favButton.onclick = doFavorite;
            paragraphBook.textContent = element.author;
            imageBook.src = element.image;
            listBook.appendChild(newCard);

            function doFavorite(event) {
              console.log(event.target.id);
              const id = event.target.id;
              fetch(" http://localhost:3000/api/favorites/" + id, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ title: "My book" }),
              })
                .then((r) => r.json())
                .then((list) => {
                  console.log("–°–æ–∑–¥–∞–Ω–æ:", list);
                  getAllFavs();
                });
            }
          });
        });

      function getAllFavs() {
        fetch("http://localhost:3000/api/favorites/")
          .then((r) => r.json())
          .then((list) => {
            const favList = document.getElementById("listFavBooks");
            favList.textContent = "";
            list.forEach((favElement) => {
              const li = document.createElement("li");
              li.classList =
                "flex flex-row justify-between mr-4 mt-4 border-gray-200 border-2 rounded-md p-2";
              const deleteButton = document.createElement("button");
              deleteButton.onclick = deleteFav;
              deleteButton.id = favElement.id;
              deleteButton.classList = "bg-red-500 text-white rounded-md";
              deleteButton.textContent = "delete";
              console.log(deleteButton);
              li.textContent = favElement.title;
              li.appendChild(deleteButton);

              favList.appendChild(li);
            });
          });
      }

      getAllFavs();

      function deleteFav(event) {
        const id = event.target.id;
        const favList = document.getElementById("listFavBooks");
        favList.removeChild(event.target.parentElement);
        fetch(" http://localhost:3000/api/favorites/" + id, {
          method: "DELETE",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ title: "Pride and Prejudice" }),
        })
          .then((r) => r.json())
          .then((list) => console.log("–£–¥–∞–ª–µ–Ω–æ:", list));
      }
    </script>
  </body>
</html>
